:root{
  --bg: #FFF3D6;
  --panel: #FFF8E6;
  --text: #111;
  --muted: #555;
  --primary: #2E7D32;
  --danger: #C62828;
  --hint: #FFB300;
  --tts: #6A1B9A;
  --record: #1565C0;
  --border: #E2C995;
  --card: #FFFDF6;

  --font-body: "Lexend", "OpenDyslexic", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;

  --radius: 16px;
  --shadow: 0 8px 26px rgba(0,0,0,0.10);
  --shadow-sm: 0 3px 12px rgba(0,0,0,0.08);
  --ring: rgba(46,125,50,.28);

  --font-scale: 1;      /* A−/A+ */
  --letter-space: .02em;
  --line-space: 1.75;
}

/* Dễ đọc (bật) */
:root[data-dys="on"]{
  --font-body: "OpenDyslexic", "Lexend", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  --letter-space: .05em;
  --line-space: 1.95;
}

html, body {
  background: radial-gradient(1200px 600px at 10% -10%, #FFF8E6, transparent) , var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  line-height: calc(var(--line-space));
  letter-spacing: var(--letter-space);
  font-size: calc(16px * var(--font-scale));
  margin: 0; padding: 0;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  transition: background-color .3s ease, color .3s ease, font-size .2s ease;
}

.app { max-width: 960px; margin: 0 auto; padding: 12px 12px 84px; }

header.appbar {
  position: sticky; top: env(safe-area-inset-top, 0);
  background: rgba(255, 243, 214, 0.75); backdrop-filter: blur(10px);
  display: flex; align-items: center; justify-content: space-between; gap: 8px;
  padding: 12px; z-index: 50; border-bottom: 1px solid var(--border);
  border-radius: 0 0 18px 18px;
}
.title { font-weight: 900; font-size: 22px; letter-spacing: 0.01em; display:flex; gap:6px; align-items:center; }
.subtitle { color: var(--muted); font-size: 12px; }

.toolbar { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
.badge { background: #fff; border: 1px solid var(--border); padding: 6px 10px; border-radius: 999px; font-size: 12px; box-shadow: var(--shadow-sm); }

.a11ybar{
  position: sticky; top: calc(env(safe-area-inset-top,0) + 60px);
  z-index: 40;
  display:flex; gap:10px; align-items:center; padding:8px 10px; margin:8px 0;
  background: rgba(255,255,255,0.6); border:1px solid var(--border); border-radius:999px; box-shadow: var(--shadow-sm);
}
.zoom{ display:flex; align-items:center; gap:6px; }
.zoom span{ min-width:46px; text-align:center; }

button{
  position: relative; font: inherit; border: none; border-radius: 14px; padding: 12px 16px;
  background: linear-gradient(180deg, #ffffff, #fff8ec);
  box-shadow: var(--shadow); cursor: pointer; transition: transform .12s ease, box-shadow .2s ease;
  outline: none;
}
button:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
button:active { transform: translateY(0); }
button:focus-visible{ box-shadow: 0 0 0 6px var(--ring); }

button.primary { background: linear-gradient(180deg, var(--primary), color-mix(in oklab, var(--primary) 70%, black 20%)); color: #fff; }
button.danger  { background: linear-gradient(180deg, var(--danger),  color-mix(in oklab, var(--danger) 70%,  black 20%)); color: #fff; }
button.hint    { background: linear-gradient(180deg, var(--hint), color-mix(in oklab, var(--hint) 70%, black 12%)); color: #111; }
button.tts     { background: linear-gradient(180deg, var(--tts),  color-mix(in oklab, var(--tts) 70%,  black 20%));  color: #fff; }
button.record  { background: linear-gradient(180deg, var(--record),color-mix(in oklab, var(--record) 70%,black 20%)); color: #fff; }
button.ghost   { background: rgba(255,255,255,0.7); box-shadow: var(--shadow-sm); border: 1px solid var(--border); }
button.tog     { background: #fff; border: 1px solid var(--border); }

.home-grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 14px; margin: 10px 0 0; }
@media (max-width:640px){ .home-grid{ grid-template-columns: 1fr; } }

.card {
  background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow);
}
.card h3 { margin: 0 0 8px 0; font-size: 18px; }

.screen { display: none; }
.screen.active { display: block; animation: fadeInUp .22s ease-out; }
@keyframes fadeInUp { from{ opacity:0; transform: translateY(6px);} to{ opacity:1; transform: translateY(0);} }

.section {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 16px; margin: 12px 0; box-shadow: var(--shadow);
}

.row { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
.spacer { flex: 1; }
.note { color: var(--muted); }
.help { font-size: 13px; color: var(--muted); background:var(--panel); padding:10px; border:1px solid var(--border); border-radius:10px; box-shadow: var(--shadow-sm); }

.big-text { font-size: clamp(22px, 5vw, 34px); line-height: 1.75; }
.token { display:inline-block; padding:2px 6px; border-radius: 8px; margin: 1px 2px; transition: transform .08s ease, box-shadow .18s ease; }
.token:hover { transform: translateY(-1px) scale(1.04); box-shadow: 0 8px 18px rgba(0,0,0,.08); }
.token:active { transform: scale(1.08); }

/* Màu theo thanh điệu */
.tone-ngang { background: #E1F5FE; }
.tone-sắc  { background: #FCE4EC; }
.tone-huyền{ background: #E8F5E9; }
.tone-hỏi  { background: #FFF8E1; }
.tone-ngã  { background: #EDE7F6; }
.tone-nặng { background: #F3E5F5; }

.stat { background:#fff; border-radius:10px; padding:8px 10px; border:1px solid var(--border); display:inline-flex; align-items:center; gap:8px; margin:4px 8px 4px 0; box-shadow: var(--shadow-sm); }

/* Stepper */
.stepper{display:flex; gap:8px; align-items:center;}
.stepper .step{display:flex; gap:6px; align-items:center; background:#fff; border:1px solid var(--border); padding:6px 10px; border-radius:999px; color:#666;}
.stepper .step span{display:inline-block; width:20px; height:20px; line-height:20px; text-align:center; border-radius:50%; background:#eee; color:#333; font-weight:700;}
.stepper .step.active{color:#111; border-color:#B5DAA7;}
.stepper .step.active span{background:#C7E6BE;}

/* Con trỏ đọc theo dòng */
.read-focus-on #passageView{
  position: relative;
}
.read-focus-on #passageView::after{
  content:""; position:absolute; left:-8px; right:-8px; top:0; height:2.2em;
  background: rgba(255, 239, 170, 0.45); border:1px solid #F4D06F; border-radius:8px; pointer-events:none;
  transform: translateY(var(--focus-y,0));
}

/* Game target */
.targetbox{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:8px 10px; box-shadow: var(--shadow-sm); }

/* Vòng sáng bóng đúng */
.balloon-halo{
  filter: drop-shadow(0 0 6px rgba(255, 193, 7, 0.9));
}

/* Footer */
.footerbar {
  position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,243,214,0.85); border-top:1px solid var(--border);
  display:flex; gap:10px; justify-content:center; padding:10px; backdrop-filter: blur(6px);
}

.modal { position: fixed; inset: 0; display:none; place-items:center; background: rgba(0,0,0,0.25); padding: 10px; z-index: 1000; }
.modal.active{ display:grid; }
.modal > .dialog { max-width: 560px; width: 100%; background: var(--panel); border:1px solid var(--border); border-radius:18px; padding:16px; box-shadow: var(--shadow); }

input[type="text"], input[type="number"], input[type="url"], select {
  font: inherit; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#fff; width:100%;
  box-shadow: var(--shadow-sm); outline: none;
}
input:focus, select:focus{ box-shadow: 0 0 0 6px var(--ring); border-color: transparent; }

.level-pill { background:#fff; border:1px solid var(--border); padding: 6px 10px; border-radius: 999px; box-shadow: var(--shadow-sm); }

/* Không ẩn Cài đặt khi Tự học */
body.child .toolbar .setup-only { opacity:.5; pointer-events:none; }

/* FX */
.fx-layer{ position: fixed; inset: 0; pointer-events: none; z-index: 9999; }
.fx-piece{ position:absolute; width:8px; height:8px; border-radius:2px; opacity:0; }
@keyframes burst { 0%{ transform: scale(.6); opacity:0 } 10%{ opacity:1 } 100%{ transform: translate(0,-80px) scale(1); opacity:0 } }