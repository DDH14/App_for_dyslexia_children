<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ฤแปc Dแป โ Hแป trแปฃ trแบป rแปi loแบกn ฤแปc</title>
  <meta name="description" content="Luyแปn รขm vแป, thแบป tแปซ, ฤแปc trรดi chแบฃy (WCPM), hiแปu nแปi dung; TTS, ghi รขm, Voice UI, dashboard, xuแบฅt CSV, ฤแปng bแป Google Drive." />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#FFF3D6" />
  <link rel="icon" href="data:image/svg+xml;utf8,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'>
    <rect width='128' height='128' fill='%23FFF3D6'/>
    <text x='50%' y='58%' dominant-baseline='middle' text-anchor='middle' font-size='80' font-family='sans-serif' fill='%23111'>ฤ</text>
  </svg>">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="app">
  <header class="appbar">
    <div>
      <div class="title">ฤแปc Dแป <span class="stars" id="starCount">โญ 0</span></div>
      <div class="subtitle">รm vแป โข Thแบป tแปซ โข ฤแปc trรดi chแบฃy โข Dashboard</div>
    </div>
    <div class="toolbar">
      <span id="learnerBadge" class="badge">Chฦฐa thiแบฟt lแบญp</span>
      <button class="tog" id="btnChild" data-voice="Bแบญt hoแบทc tแบฏt chแบฟ ฤแป tแปฑ hแปc">๐ธ Tแปฑ hแปc: Tแบฏt</button>
      <button class="tog" id="btnVoice" data-voice="Bแบญt hoแบทc tแบฏt giแปng nรณi trแปฃ giรบp">๐ Giแปng nรณi: Bแบญt</button>
      <button class="ghost setup-only" id="btnSettings" data-voice="Cรi ฤแบทt">Cรi ฤแบทt</button>
      <button class="ghost" id="btnHelp" data-voice="Hฦฐแปng dแบซn">Hฦฐแปng dแบซn</button>
    </div>
  </header>

  <!-- HOME -->
  <section id="screen-home" class="screen active">
    <div class="home-grid">
      <div class="card">
        <h3>๐ฏ Luyแปn รขm vแป</h3>
        <div class="note">Kรฉoโthแบฃ รขm/tiแบฟng, thanh ฤiแปu, cแบทp tแปi thiแปu.</div>
        <div class="inline-buttons" style="margin-top:10px;">
          <button class="primary" onclick="App.nav('pa')" data-voice="Luyแปn รขm vแป. Bแบฏt ฤแบงu">Bแบฏt ฤแบงu</button>
          <button class="tts" onclick="App.speak('Luyแปn รขm vแป')" data-voice="Nghe hฦฐแปng dแบซn Luyแปn รขm vแป">๐ Nghe</button>
        </div>
      </div>

      <div class="card">
        <h3>๐ Thแบป tแปซ</h3>
        <div class="note">Nhแบญn diแปn tแปซ theo lแบทp lแบกi giรฃn cรกch.</div>
        <div class="inline-buttons" style="margin-top:10px;">
          <button class="primary" onclick="App.nav('cards')" data-voice="Thแบป tแปซ. รn tแบญp">รn tแบญp</button>
        </div>
      </div>

      <div class="card">
        <h3>๐ ฤแปc ฤoแบกn</h3>
        <div class="note">ฤo WCPM, % ฤรบng, hiแปu nแปi dung; ghi รขm โ nghe lแบกi.</div>
        <div class="inline-buttons" style="margin-top:10px;">
          <button class="primary" onclick="App.nav('reading')" data-voice="ฤแปc ฤoแบกn. Luyแปn ฤแปc">Luyแปn ฤแปc</button>
        </div>
      </div>

      <div class="card">
        <h3>๐ Dashboard</h3>
        <div class="note">Biแปu ฤแป tiแบฟn bแป, lแปi theo loแบกi, xuแบฅt CSV, ฤแปng bแป.</div>
        <div class="inline-buttons" style="margin-top:10px;">
          <button class="primary" onclick="App.nav('dashboard')" data-voice="Mแป bแบฃng ฤiแปu khiแปn">Mแป Dashboard</button>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="row">
        <div class="level-pill">Gแปฃi รฝ cแบฅp ฤแป ฤแปc tiแบฟp theo: <b id="nextLevelHint">โ</b></div>
        <div class="spacer"></div>
        <button onclick="App.nav('export')" data-voice="Xuแบฅt dแปฏ liแปu">Xuแบฅt dแปฏ liแปu</button>
      </div>
    </div>
  </section>

  <!-- PA -->
  <section id="screen-pa" class="screen">
    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vแป trang chรญnh">โ Vแป trang chรญnh</button>
      <div class="spacer"></div>
      <span class="badge">รm vแป hแปc</span>
    </div>
    <div class="section" id="pa-container"></div>
    <div class="help">Mแบนo: Nhแบฅn โ๐โ ฤแป nghe mแบซu; kรฉoโthแบฃ โhแบกt รขm/tiแบฟngโ ฤแป rรกp tแปซ; hoแบทc chแปn thanh ฤiแปu/cแบทp tแปi thiแปu theo yรชu cแบงu.</div>
  </section>

  <!-- Cards -->
  <section id="screen-cards" class="screen">
    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vแป trang chรญnh">โ Vแป trang chรญnh</button>
      <div class="spacer"></div>
      <span class="badge">Thแบป tแปซ</span>
    </div>
    <div class="section" id="cards-container"></div>
    <div class="help">ฤรกnh giรก โDแป/Vแปซa/Khรณโ ฤแป แปฉng dแปฅng tแปฑ ฤแปng hแบนn ngรy รดn.</div>
  </section>

  <!-- Reading -->
  <section id="screen-reading" class="screen">
    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vแป trang chรญnh">โ Vแป trang chรญnh</button>
      <div class="spacer"></div>
      <span class="badge">ฤแปc ฤoแบกn</span>
    </div>

    <div class="section">
      <div class="row">
        <label for="selLevel" style="margin:0;">Cแบฅp ฤแป:</label>
        <select id="selLevel" onchange="App.reading.chooseLevel(this.value)" aria-label="Chแปn cแบฅp ฤแป"></select>
        <div class="spacer"></div>
        <div class="slider" data-voice="ฤiแปu chแปnh tแปc ฤแป giแปng ฤแปc">
          <span>๐ Tแปc ฤแป</span>
          <input id="rateSlider" type="range" min="0.6" max="1.4" step="0.05" value="0.9"
                 oninput="App.updateRateFromSlider(this.value)"
                 onfocus="VoiceUI.speak('Thanh tแปc ฤแป giแปng ฤแปc')" />
          <span id="rateVal">0.90x</span>
        </div>
        <button class="ghost" onclick="App.reading.toggleFocus()" id="btnFocus" data-voice="Bแบญt tแบฏt chแบฟ ฤแป mแปt dรฒng">Chแบฟ ฤแป 1 dรฒng: Tแบฏt</button>
      </div>
    </div>

    <div class="section">
      <div class="row">
        <button class="primary" id="btnStartRead" onclick="App.reading.start()" data-voice="Bแบฏt ฤแบงu ฤแปc vร tรญnh giแป">Bแบฏt ฤแบงu ฤแปc</button>
        <button id="btnStopRead" class="danger" onclick="App.reading.stop()" disabled data-voice="Kแบฟt thรบc bรi ฤแปc">Kแบฟt thรบc</button>
        <button class="tts" onclick="App.reading.speakPassage()" data-voice="Nghe toรn bแป ฤoแบกn">๐ Nghe ฤoแบกn</button>
        <button class="record" id="btnRec" onclick="App.reading.toggleRec()" data-voice="Ghi รขm giแปng ฤแปc hoแบทc nghe lแบกi">Ghi รขm</button>
        <span class="stat">โฑ๏ธ <span id="timer">00:00</span></span>
        <span class="stat">WCPM: <b id="statWCPM">โ</b></span>
        <span class="stat">% ฤรบng: <b id="statAcc">โ</b></span>
      </div>
    </div>

    <div class="section">
      <div id="passageView" class="big-text"></div>
      <div class="inline-buttons">
        <button class="hint" onclick="App.reading.markMode('error')" id="btnErr" data-voice="Chแบฟ ฤแป ฤรกnh dแบฅu lแปi">ฤรกnh dแบฅu lแปi</button>
        <button class="ghost" onclick="App.reading.markMode('normal')" id="btnNorm" data-voice="Chแบฟ ฤแป bรฌnh thฦฐแปng">Chแบฟ ฤแป bรฌnh thฦฐแปng</button>
      </div>
      <div class="help">Chแบกm vรo tแปซ ฤแป ฤรกnh dแบฅu lแปi; chแบกm lแบกi ฤแป bแป. Nhแบฅn vร giแปฏ ฤแป chแปn loแบกi lแปi. Chแบกm vรo tแปซ ฤแป nghe lแบกi phรกt รขm.</div>
    </div>

    <div id="compSection" class="section" style="display:none;">
      <h3>Cรขu hแปi hiแปu nแปi dung</h3>
      <div id="questions"></div>
      <div class="row" style="margin-top:8px;">
        <div class="spacer"></div>
        <button class="primary" onclick="App.reading.finishComp()" data-voice="Hoรn tแบฅt cรขu hแปi">Hoรn tแบฅt</button>
      </div>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="screen-dashboard" class="screen">
    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vแป trang chรญnh">โ Vแป trang chรญnh</button>
      <div class="spacer"></div>
      <span class="badge">Dashboard</span>
    </div>

    <div class="grid-2">
      <div class="section">
        <h3>WCPM theo thแปi gian</h3>
        <canvas id="chartWCPM" width="600" height="260"></canvas>
      </div>
      <div class="section">
        <h3>% chรญnh xรกc theo thแปi gian</h3>
        <canvas id="chartACC" width="600" height="260"></canvas>
      </div>
      <div class="section">
        <h3>Tแปng lแปi theo loแบกi</h3>
        <canvas id="chartERR" width="600" height="260"></canvas>
      </div>
      <div class="section">
        <h3>Thแปi lฦฐแปฃng luyแปn tแบญp</h3>
        <canvas id="chartDUR" width="600" height="260"></canvas>
      </div>
    </div>

    <div class="section">
      <div class="row">
        <button onclick="App.exportCSV()" data-voice="Tแบฃi tแปp CSV">Tแบฃi CSV</button>
        <button class="ghost" onclick="App.copyCSV()" data-voice="Sao chรฉp CSV">Sao chรฉp CSV</button>
        <div class="spacer"></div>
        <button class="danger" onclick="App.resetConfirm()" data-voice="Xรณa dแปฏ liแปu trรชn thiแบฟt bแป nรy">Xรณa dแปฏ liแปu (thiแบฟt bแป nรy)</button>
      </div>
      <div class="help">CSV mแป bแบฑng Excel/Google Sheets. Dแปฏ liแปu chแป lฦฐu trรชn thiแบฟt bแป nรy trแปซ khi bแบกn bแบญt ฤแปng bแป.</div>
    </div>

    <div class="section">
      <h3>ฤแปng bแป Google Drive</h3>
      <div class="row">
        <div class="spacer"></div>
        <span class="badge" id="syncStatus">Trแบกng thรกi: chฦฐa cแบฅu hรฌnh</span>
      </div>
      <div class="inline-buttons" style="margin-top:10px;">
        <button onclick="Sync.flush()" data-voice="ฤแปng bแป dแปฏ liแปu ngay">ฤแปng bแป ngay</button>
        <button class="ghost" onclick="App.testSync()" data-voice="Kiแปm tra kแบฟt nแปi ฤแปng bแป">Kiแปm tra kแบฟt nแปi</button>
        <button class="ghost" onclick="App.showSyncHelp()" data-voice="Hฦฐแปng dแบซn thiแบฟt lแบญp ฤแปng bแป">Hฦฐแปng dแบซn thiแบฟt lแบญp</button>
      </div>
      <div class="help">แปจng dแปฅng gแปญi log ฤแปc (WCPM, % ฤรบng, lแปi, hiแปu) tแปi Apps Script, rแปi lฦฐu vรo Google Drive cแปงa bแบกn.</div>
    </div>
  </section>

  <!-- Export -->
  <section id="screen-export" class="screen">
    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vแป trang chรญnh">โ Vแป trang chรญnh</button>
      <div class="spacer"></div>
      <span class="badge">Xuแบฅt dแปฏ liแปu</span>
    </div>
    <div class="section">
      <div class="row">
        <button onclick="App.exportCSV()" data-voice="Tแบฃi tแปp CSV">Tแบฃi CSV</button>
        <button class="ghost" onclick="App.copyCSV()" data-voice="Sao chรฉp CSV">Sao chรฉp CSV</button>
      </div>
      <div class="help">Dรกn vรo Google Sheets ฤแป theo dรตi dรi hแบกn.</div>
    </div>
  </section>

  <!-- Settings -->
  <section id="screen-settings" class="screen">
    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vแป trang chรญnh">โ Vแป trang chรญnh</button>
      <div class="spacer"></div>
      <span class="badge">Cรi ฤแบทt</span>
    </div>

    <div class="section">
      <div class="grid-2">
        <div>
          <label>Mรฃ hแปc viรชn (khรดng dรนng tรชn thแบญt)</label>
          <input type="text" id="inpId" placeholder="VD: HS001" />
        </div>
        <div>
          <label>Tuแปi</label>
          <input type="number" id="inpAge" min="5" max="15" />
        </div>
        <div>
          <label>Khแปi/lแปp</label>
          <input type="text" id="inpGrade" placeholder="VD: Lแปp 2" />
        </div>
        <div>
          <label>Phรดng chแปฏ</label>
          <select id="selFont">
            <option>Lexend</option>
            <option>OpenDyslexic</option>
            <option selected>System Sans</option>
          </select>
        </div>
        <div>
          <label>Tแปc ฤแป TTS (0.6โ1.4)</label>
          <input type="number" id="inpRate" value="0.9" step="0.05" min="0.6" max="1.4" />
        </div>
        <div>
          <label>Cแบฅp ฤแป ฤแปc ban ฤแบงu</label>
          <select id="selStartLevel"></select>
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" onclick="App.saveSettings()" data-voice="Lฦฐu cรi ฤแบทt">Lฦฐu</button>
      </div>
      <div class="help">โSystem Sansโ tฦฐฦกng thรญch mแปi mรกy. Nแบฟu mรกy cรณ Lexend/OpenDyslexic, แปฉng dแปฅng sแบฝ ฦฐu tiรชn dรนng.</div>
    </div>

    <div class="section">
      <h3>ฤแปng bแป Google Drive</h3>
      <div class="grid-2">
        <div>
          <label>ฤแปng bแป (Apps Script URL)</label>
          <input type="url" id="inpSyncUrl" placeholder="https://script.google.com/macros/s/XXX/exec" />
        </div>
        <div>
          <label>Mแบญt mรฃ bรญ mแบญt (SECRET)</label>
          <input type="text" id="inpSyncSecret" placeholder="docde-secret-2025" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button onclick="App.saveSync()" data-voice="Lฦฐu cรi ฤแบทt ฤแปng bแป">Lฦฐu ฤแปng bแป</button>
        <button class="ghost" onclick="App.testSync()" data-voice="Kiแปm tra kแบฟt nแปi ฤแปng bแป">Kiแปm tra kแบฟt nแปi</button>
      </div>
      <div class="help">Sao chรฉp URL Web App tแปซ Google Apps Script (Execute as: Me, Access: Anyone). SECRET phแบฃi trรนng trong Script.</div>
    </div>
  </section>

  <!-- Help -->
  <div id="modalHelp" class="modal">
    <div class="dialog">
      <h3>Hฦฐแปng dแบซn nhanh</h3>
      <ul>
        <li>รm vแป: 5โ7 phรบt, 6โ8 mแปฅc tiรชu theo lแปi hay gแบทp.</li>
        <li>Thแบป tแปซ: 5 phรบt, 10โ15 thแบป (Dแป/Vแปซa/Khรณ).</li>
        <li>ฤแปc ฤoแบกn: 3 lแบงn/ฤoแบกn, ฤo WCPM & % ฤรบng; lรm 2โ3 cรขu hแปi hiแปu.</li>
        <li>Giแปng nรณi trแปฃ giรบp: Nhแบฅn giแปฏ 0.4 giรขy lรชn nรบt ฤแป nghe tรชn trฦฐแปc khi bแบฅm.</li>
      </ul>
      <div class="row">
        <div class="spacer"></div>
        <button onclick="document.getElementById('modalHelp').classList.remove('active')" data-voice="ฤรณng hฦฐแปng dแบซn">ฤรฃ hiแปu</button>
      </div>
    </div>
  </div>

  <!-- Onboarding -->
  <div id="modalOnboard" class="modal">
    <div class="dialog">
      <h3>Thiแบฟt lแบญp nhanh</h3>
      <div class="grid-2">
        <div>
          <label>Mรฃ hแปc viรชn</label>
          <input type="text" id="obId" placeholder="VD: HS001"/>
        </div>
        <div>
          <label>Tuแปi</label>
          <input type="number" id="obAge" min="5" max="15"/>
        </div>
        <div>
          <label>Khแปi/lแปp</label>
          <input type="text" id="obGrade" placeholder="VD: Lแปp 2"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" onclick="App.finishOnboard()" data-voice="Bแบฏt ฤแบงu sแปญ dแปฅng">Bแบฏt ฤแบงu</button>
      </div>
      <div class="help">Dแปฏ liแปu แบฉn danh, chแป lฦฐu cแปฅc bแป nแบฟu bแบกn chฦฐa bแบญt ฤแปng bแป.</div>
    </div>
  </div>

  <!-- Chแปn loแบกi lแปi -->
  <div id="errorMenu" class="modal" style="background: transparent;">
    <div class="dialog" style="max-width:380px;">
      <h3>Chแปn loแบกi lแปi</h3>
      <div class="row" style="flex-wrap: wrap;">
        <button onclick="App.reading.setErrType('tone')" data-voice="Sai thanh ฤiแปu">Sai thanh ฤiแปu</button>
        <button onclick="App.reading.setErrType('sx')" data-voice="Nhแบงm s vร x">Nhแบงm s x</button>
        <button onclick="App.reading.setErrType('chtr')" data-voice="Nhแบงm ch vร tr">Nhแบงm ch tr</button>
        <button onclick="App.reading.setErrType('omission')" data-voice="Bแป รขm hoแบทc bแป tแปซ">Bแป รขm</button>
        <button onclick="App.reading.setErrType('insertion')" data-voice="Thรชm รขm hoแบทc thรชm tแปซ">Thรชm รขm</button>
        <button onclick="App.reading.setErrType('other')" data-voice="Lแปi khรกc">Khรกc</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <div class="spacer"></div>
        <button class="ghost" onclick="document.getElementById('errorMenu').classList.remove('active')" data-voice="ฤรณng bแบฃng chแปn lแปi">ฤรณng</button>
      </div>
    </div>
  </div>

  <!-- Khoรก/thoรกt Child Mode -->
  <div class="lockbar" id="lockbar" style="display:none;">
    <span>๐ธ Tแปฑ hแปc ฤang bแบญt</span>
    <button class="ghost" id="btnUnlock" data-voice="Giแปฏ ba giรขy ฤแป thoรกt tแปฑ hแปc">Giแปฏ 3s ฤแป thoรกt</button>
  </div>

</div>

<div class="footerbar">
  <button onclick="App.nav('home')" data-voice="Trang chรญnh">Trang chรญnh</button>
  <button onclick="App.nav('pa')" data-voice="รm vแป">รm vแป</button>
  <button onclick="App.nav('cards')" data-voice="Thแบป tแปซ">Thแบป tแปซ</button>
  <button onclick="App.nav('reading')" data-voice="ฤแปc ฤoแบกn">ฤแปc ฤoแบกn</button>
  <button onclick="App.nav('dashboard')" data-voice="Bแบฃng ฤiแปu khiแปn">Dashboard</button>
</div>

<!-- Scripts: tรกch nhแป theo trรกch nhiแปm -->
<script src="app/data.js"></script>
<script src="app/store.js"></script>
<script src="app/tts.js"></script>
<script src="app/voiceui.js"></script>
<script src="app/recorder.js"></script>
<script src="app/coach.js"></script>
<script src="app/utils.js"></script>
<script src="app/charts.js"></script>
<script src="app/adaptive.js"></script>
<script src="app/sr.js"></script>
<script src="app/sync.js"></script>

<script src="app/modules/pa.js"></script>
<script src="app/modules/cards.js"></script>
<script src="app/modules/reading.js"></script>
<script src="app/modules/dashboard.js"></script>

<script src="app/app.js"></script>
</body>
</html>